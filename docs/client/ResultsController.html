<!DOCTYPE html>

<html>
<head>
  <title>ResultsController.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="config.html">
                config.js
              </a>
            
              
              <a class="source" href="ColorIndexService.html">
                ColorIndexService.js
              </a>
            
              
              <a class="source" href="HomeController.html">
                HomeController.js
              </a>
            
              
              <a class="source" href="MultiplayerController.html">
                MultiplayerController.js
              </a>
            
              
              <a class="source" href="index.html">
                index.js
              </a>
            
              
              <a class="source" href="LoginController.html">
                LoginController.js
              </a>
            
              
              <a class="source" href="main.html">
                main.js
              </a>
            
              
              <a class="source" href="ProfileController.html">
                ProfileController.js
              </a>
            
              
              <a class="source" href="ResultsController.html">
                ResultsController.js
              </a>
            
              
              <a class="source" href="services.html">
                services.js
              </a>
            
              
              <a class="source" href="SignUpController.html">
                SignUpController.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>ResultsController.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
app.controller(<span class="hljs-string">'ResultsController'</span>, [<span class="hljs-string">'$scope'</span>, <span class="hljs-string">'$timeout'</span>, <span class="hljs-string">'Results'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $timeout, Results</span>) </span>{

    <span class="hljs-keyword">var</span> margin = {top: <span class="hljs-number">20</span>, right: <span class="hljs-number">20</span>, bottom: <span class="hljs-number">30</span>, left: <span class="hljs-number">50</span>},
      width = <span class="hljs-number">960</span> - margin.left - margin.right,
      height = <span class="hljs-number">500</span> - margin.top - margin.bottom;

    <span class="hljs-keyword">var</span> svg = d3.select(<span class="hljs-string">"#graph"</span>).append(<span class="hljs-string">"svg"</span>)
      .attr(<span class="hljs-string">"width"</span>, width + margin.left + margin.right)
      .attr(<span class="hljs-string">"height"</span>, height + margin.top + margin.bottom)
    .append(<span class="hljs-string">"g"</span>)
      .attr(<span class="hljs-string">"class"</span>, <span class="hljs-string">"graph"</span>)
      .attr(<span class="hljs-string">"transform"</span>, <span class="hljs-string">"translate("</span> + margin.left + <span class="hljs-string">","</span> + margin.top + <span class="hljs-string">")"</span>);    

    $scope.duration = Results.getDuration();
    $scope.scores = Results.getScores();
    $scope.rawText = Results.getText();
    $scope.minuteScores = Results.getScoresPerMinute();
    $scope.wordCount = Results.getWordCount();
    $scope.charCount = Results.getCharacterCount();
    $scope.wpm = $scope.wordCount / $scope.duration;
    $scope.cpm = $scope.charCount / $scope.duration;
    $scope.total = Results.getTotalScore();
    $scope.possible = $scope.duration * <span class="hljs-number">60</span> * <span class="hljs-number">10000</span>;
    $scope.consistency = $scope.total / $scope.possible;
  
    $scope.sendResultsToServer = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> resultsObj = {};

      resultsObj.session_time = $scope.duration;
      resultsObj.char_count = $scope.charCount;
      resultsObj.text = $scope.rawText;
      resultsObj.scores = $scope.minuteScores;
      resultsObj.word_count = $scope.wordCount;

      Results.postResults(resultsObj);
    };

    <span class="hljs-keyword">var</span> parseData = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">array</span>) </span>{
        <span class="hljs-keyword">var</span> result = [];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; array.length; i++) {
          <span class="hljs-keyword">var</span> d = {};
          d.increment = i;
          d.point = array[i];
          result.push(d);
        }
        <span class="hljs-keyword">return</span> result;
    };

    <span class="hljs-keyword">var</span> removeGraph = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

      $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'removing graph'</span>);

        <span class="hljs-keyword">var</span> graph = d3.select(<span class="hljs-string">"svg"</span>).select(<span class="hljs-string">".graph"</span>);

        <span class="hljs-built_in">console</span>.log(graph);

        graph.select(<span class="hljs-string">'g.horizontal'</span>)
          .transition()
            .duration(<span class="hljs-number">1500</span>)
            .attr(<span class="hljs-string">"transform"</span>, <span class="hljs-string">"translate("</span> + width + <span class="hljs-string">","</span> + height + <span class="hljs-string">")"</span>)
            .style(<span class="hljs-string">"fill-opacity"</span>, <span class="hljs-number">1e-6</span>)
            .style(<span class="hljs-string">"stroke-opacity"</span>, <span class="hljs-number">1e-6</span>)
            .remove();
        
        graph.select(<span class="hljs-string">'g.vertical'</span>)
          .transition()
            .duration(<span class="hljs-number">1500</span>)
            .attr(<span class="hljs-string">"transform"</span>, <span class="hljs-string">"translate(0,"</span> + height + <span class="hljs-string">")"</span>)
            .style(<span class="hljs-string">"fill-opacity"</span>, <span class="hljs-number">1e-6</span>)
            .style(<span class="hljs-string">"stroke-opacity"</span>, <span class="hljs-number">1e-6</span>)
            .remove();

        graph.select(<span class="hljs-string">'path.line'</span>)
          .transition()
            .duration(<span class="hljs-number">1500</span>)
            .attr(<span class="hljs-string">"transform"</span>, <span class="hljs-string">"translate("</span> + width + <span class="hljs-string">", 0)"</span>)
            .style(<span class="hljs-string">"stroke-opacity"</span>, <span class="hljs-number">1e-6</span>)
            .remove();
      }, <span class="hljs-number">1</span>);

    }


    <span class="hljs-keyword">var</span> createGraph = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dataArray, yLabel</span>) </span>{

        <span class="hljs-keyword">var</span> x = d3.scale.linear()
          .range([<span class="hljs-number">0</span>, width]);

        <span class="hljs-keyword">var</span> y = d3.scale.linear()
          .range([height, <span class="hljs-number">0</span>]);

        <span class="hljs-keyword">var</span> xAxis = d3.svg.axis()
          .scale(x)
          .orient(<span class="hljs-string">"bottom"</span>);

        <span class="hljs-keyword">var</span> yAxis = d3.svg.axis()
          .scale(y)
          .orient(<span class="hljs-string">"left"</span>);

        <span class="hljs-keyword">var</span> line = d3.svg.line()
          .x(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> x(d.increment); })
          .y(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> y(d.point); });

        <span class="hljs-keyword">var</span> data = parseData(dataArray);

        x.domain(d3.extent(data, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> d.increment; }));
        y.domain(d3.extent(data, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> d.point; }));

        $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'appending svg'</span>);
          
            svg.append(<span class="hljs-string">"g"</span>)
                .attr(<span class="hljs-string">"class"</span>, <span class="hljs-string">"x axis horizontal"</span>)
                .transition()
                  .duration(<span class="hljs-number">1500</span>)
                  .attr(<span class="hljs-string">"transform"</span>, <span class="hljs-string">"translate(0,"</span> + height + <span class="hljs-string">")"</span>)
                  .call(xAxis);

            svg.append(<span class="hljs-string">"g"</span>)
                .transition()
                  .duration(<span class="hljs-number">1500</span>)
                  .attr(<span class="hljs-string">"class"</span>, <span class="hljs-string">"y axis vertical"</span>)
                  .call(yAxis);

            svg.select(<span class="hljs-string">".vertical"</span>).append(<span class="hljs-string">"text"</span>)
                .transition()
                  .duration(<span class="hljs-number">1500</span>)
                  .attr(<span class="hljs-string">"class"</span>, <span class="hljs-string">"y label"</span>)
                  .attr(<span class="hljs-string">"transform"</span>, <span class="hljs-string">"rotate(-90)"</span>)
                  .attr(<span class="hljs-string">"y"</span>, <span class="hljs-number">6</span>)
                  .attr(<span class="hljs-string">"dy"</span>, <span class="hljs-string">".71em"</span>)
                  .style(<span class="hljs-string">"text-anchor"</span>, <span class="hljs-string">"end"</span>)
                  .text(yLabel);

            svg.append(<span class="hljs-string">"path"</span>)
              .datum(data)
              .attr(<span class="hljs-string">"class"</span>, <span class="hljs-string">"line"</span>)
              .transition()
                .duration(<span class="hljs-number">1500</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>.style(“stroke-opacity”, 1e-6)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                .style(<span class="hljs-string">"stroke-opacity"</span>, <span class="hljs-number">1</span>)
                .attr(<span class="hljs-string">"d"</span>, line);

        }, <span class="hljs-number">1</span>);
    };

    createGraph($scope.scores, <span class="hljs-string">"Score"</span>);

    $scope.graphScores = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      removeGraph();
      $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        createGraph($scope.scores, <span class="hljs-string">"Score"</span>);
      }, <span class="hljs-number">2000</span>);
    };


    $scope.graphConsistency = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> potential, data = [];
      _.reduce(Results.getScores(), <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">memo, score, index</span>) </span>{
        memo += score;
        potential = (index + <span class="hljs-number">1</span>) * <span class="hljs-number">10000</span>;
        data.push((memo/potential) * <span class="hljs-number">100</span>);
        <span class="hljs-keyword">return</span> memo;
      }, <span class="hljs-number">0</span>);
    
      removeGraph();
      $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        createGraph(data, <span class="hljs-string">"Consistency"</span>);
      }, <span class="hljs-number">2000</span>);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>$scope.debugSendValues = function(valuesObj) {
  console.log(‘inside the debug send values controller’);
  console.log(valuesObj);</p>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>};</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
}]);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
